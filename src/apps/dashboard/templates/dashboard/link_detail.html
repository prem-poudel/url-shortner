{% extends "base.html" %}
{% block title %} | Link Details{% endblock %}

{% block content %}
{% include "navbar.html" %}

<div class="container my-5">

    <!-- Header with actions -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3 gap-2">
        <h3 class="m-0">Short URL Details</h3>
        <div class="d-flex gap-2 flex-wrap">
            <form method="POST" action="{% url 'generate_qr_code' link.id %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-dark py-2 px-3 fs-6">
                    <i class="bi bi-qr-code"></i> Generate QR
                </button>
            </form>
            <form method="POST" action="{% url 'delete_short_link' link.id %}" onsubmit="return confirm('Are you sure you want to delete this link?');" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-danger py-2 px-3 fs-6">
                    <i class="bi bi-trash"></i> Delete
                </button>
            </form>
        </div>
    </div>

    <!-- Short Link -->
    <h5>Short URL</h5>
    <p class="mb-3">
        <a href="https://{{ request.get_host }}/{{ link.short_code }}" target="_blank" class="text-decoration-none fw-semibold">
            https://{{ request.get_host }}/{{ link.short_code }}
        </a>
    </p>

    <!-- Original URL -->
    <h5>Original URL</h5>
    <p class="text-truncate" style="max-width: 100%;">{{ link.original_url }}</p>

    <!-- Stats Badges -->
    <div class="row mt-3 text-center g-2">
        <div class="col-6 col-md-4">
            <span class="badge bg-success fs-6 w-100">Clicks: {{ link.clicks }}</span>
        </div>
        <div class="col-6 col-md-4">
            {% if link.is_active %}
                <span class="badge bg-primary fs-6 w-100">Active</span>
            {% else %}
                <span class="badge bg-danger fs-6 w-100">Inactive</span>
            {% endif %}
        </div>
        <div class="col-12 col-md-4">
            <span class="badge bg-info fs-6 w-100">Created: {{ link.created_at|date:"M d, Y" }}</span>
        </div>
    </div>

    <!-- Update Form -->
    <div class="mt-4">
        <h5>Update Link Details</h5>
        <form method="POST" action="{% url 'update_short_link' link.id %}" onsubmit="alert('All used url wont work.')" class="row g-3 align-items-end">
            {% csrf_token %}
            <!-- <div class="col-md-5">
                <label for="expiration_date" class="form-label">Expiration Date</label>
                <input type="date" name="expiration_date" id="expiration_date" class="form-control" value="{{ link.expiration_date|date:'Y-m-d' }}">
            </div> -->
            <div class="col-md-5">
                <label for="is_active" class="form-label">Status</label>
                <select name="is_active" id="is_active" class="form-select">
                    <option value="True" {% if link.is_active %}selected{% endif %}>Active</option>
                    <option value="False" {% if not link.is_active %}selected{% endif %}>Inactive</option>
                </select>
            </div>
            <div class="col-md-2 d-grid">
                <button type="submit" class="btn btn-primary btn-block py-2 fs-6">
                    Update
                </button>
            </div>
        </form>
    </div>
<!-- QR Code Section -->
    <div class="mt-5 text-center">
        {% if link.qr_code %}
            <h4 class="mb-3">Link QR</h4>
            <div class="d-inline-block p-3 border rounded shadow-sm" style="background: #f9f9f9;">
                <img src="{{ link.qr_code.url }}" alt="QR Code" class="img-fluid" style="max-width: 250px;">
            </div>
            <p class="mt-2 mb-3 fw-semibold">ðŸ“± Scan Me</p>

            <a href="{{ link.qr_code.url }}" download class="btn btn-primary btn-sm">
                <i class="bi bi-download"></i> Download QR
            </a>
        {% else %}
            <p class="text-muted">No QR available for this short link.</p>
        {% endif %}
    </div>


</div>
{% endblock %}
